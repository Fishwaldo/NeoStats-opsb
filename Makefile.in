#Neostats Module Makefile
CC = @CC@
CFLAGS = @CFLAGS@
LDFLAGS = @LIBS@
INSTALL = @INSTALL@                                                                                                                 
INSTALL_PROGRAM = @INSTALL_PROGRAM@                                                                                                 
INSTALL_DATA = @INSTALL_DATA@
DIRECTORY = @DIRINST@/modules/
INCLUDES = -I@DIRINST@/include/ -I. -Ilibopm

SRCS = opsb.c proxy.c opsb_help.c
OBJS = ${SRCS:.c=.o}
TARGET = opsb.so                 
DOCS = README.opsb README.opsb.html
DATA =
SCRIPTS = 
DISTFILES = $(SRCS) $(DOCS) modconfig.h.in configure install-sh ChangeLog Makefile.in opsb.h libopm/*.c libopm/*.h libopm/README libopm/LICENSE LICENSE libopm/*.in libopm/*.vcproj RELNOTES opsb.vcproj modconfigwin32.h
DISTDIR = @PACKAGE@-@VERSION@

all:	module
		@echo "Compilation complete."
		@echo "Run 'make install' (or 'gmake install' on some systems) to install."
		@echo "If you require support, see the README file."

# include dependency info
@MAKEDEPENDENCIES@

.c.o:	
	$(CC) -c $(CFLAGS) $(INCLUDES) $<
	$(CC) -MM $(INCLUDES) -c $< > $*.d

libopm.a:
	 (cd libopm; $(MAKE) $@)
	 
module:	 libopm.a $(OBJS)
	 $(LD) -shared -o $(TARGET) $(LDFLAGS) $(OBJS) libopm/libopm.a

clean:   
	 (cd libopm; $(MAKE) $@)
	 /bin/rm -rf $(TARGET) *.o Makefile *.log modconfig.h

install: module
	 $(INSTALL) -m 644 $(TARGET) $(DIRECTORY)
	 $(INSTALL) -m 644 $(DOCS) $(DIRECTORY)../doc/
	@echo "Installation complete."
	@echo "See the README file for instructions on loading this module."

dist:	
	@echo -n "Creating directories"
	@-rm -rf $(DISTDIR)
	@mkdir $(DISTDIR)
	@mkdir $(DISTDIR)/libopm
	@echo "Done"
	@echo -n "Copying distribution files"
	@for file in $(DISTFILES); do \
		echo -n "."; \
		cp -pr $$file $(DISTDIR)/$$file; \
	done
	@echo "Done"
	@tar -czf $(DISTDIR).tar.gz $(DISTDIR)/*
	@echo "Tar file $(DISTDIR).tar.gz created, Freshmeat Time"

$(OBJS): Makefile
